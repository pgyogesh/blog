---
layout: single
comments: true
excerpt: "As a DBA, Many times we have to collect the row count for all the tables in database. Below are the two steps that can fulfill the requirement of getting the row count of all tables."
header:
  overlay_image: https://source.unsplash.com/random/1200x400?nature
  overlay_filter: 0.5
title:  "Getting row count for all the tables in Database"
date:   2018-06-20 10:10:10 +0800
categories: Greenplum
read: 5 Mins
tags: postgresql greenplum scripts sql
---



### FUNCTION
{% highlight SQL linenos %}
CREATE OR REPLACE FUNCTION 
get_count(schema text, tablename text) RETURNS integer
AS
$body$
DECLARE
  result integer;
  query varchar;
BEGIN
  query := 'SELECT count(1) FROM ' || schema || '.' || tablename;
  EXECUTE query INTO result;
  RETURN result;
END;
$body$
LANGUAGE plpgsql;
{% endhighlight %}

### Query to get count

{% highlight SQL linenos %}

SELECT
     n.nspname as "Schema",
     c.relname as "Table",
     get_count(n.nspname, c.relname) as "Row count"
FROM pg_catalog.pg_class c
     LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
WHERE c.relkind = 'r'
AND c.relstorage != 'x' -- to exclude the external tables
AND n.nspname <> 'pg_catalog'
AND n.nspname <> 'information_schema'
ORDER BY 3 desc;

{% endhighlight %}

### Result

Schema |               Table               | Row count
-------|-----------------------------------|-----------
public | ttblsize                          |   10416272
public | test_yogesh                       |      11000
public | tdbsize                           |       7129
public | reorg_history                     |        190
public | vacuum_history                    |         23
public | test11                            |         20
public | test_after_upgrade                |          5
public | test_sravan                       |          3
public | test12                            |          1
